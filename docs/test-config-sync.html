<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é…ç½®åŒæ­¥åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ é…ç½®åŒæ­¥åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. åŸºç¡€æ£€æŸ¥</h2>
        <button class="test-button" onclick="checkBasicSetup()">æ£€æŸ¥åŸºç¡€è®¾ç½®</button>
        <div id="basic-status"></div>
    </div>

    <div class="test-section">
        <h2>2. é…ç½®åŒæ­¥å¯¹è±¡æ£€æŸ¥</h2>
        <button class="test-button" onclick="checkConfigSync()">æ£€æŸ¥ConfigSyncå¯¹è±¡</button>
        <div id="configsync-status"></div>
    </div>

    <div class="test-section">
        <h2>3. åˆå§‹åŒ–æµ‹è¯•</h2>
        <button class="test-button" onclick="testInitialization()">æµ‹è¯•åˆå§‹åŒ–</button>
        <div id="init-status"></div>
    </div>

    <div class="test-section">
        <h2>4. æ–¹æ³•è°ƒç”¨æµ‹è¯•</h2>
        <button class="test-button" onclick="testMethods()">æµ‹è¯•æ–¹æ³•è°ƒç”¨</button>
        <div id="methods-status"></div>
    </div>

    <div class="test-section">
        <h2>5. æ‰‹åŠ¨åˆå§‹åŒ–</h2>
        <button class="test-button" onclick="manualInit()">æ‰‹åŠ¨åˆå§‹åŒ–</button>
        <div id="manual-status"></div>
    </div>

    <div class="test-section">
        <h2>6. è°ƒè¯•ä¿¡æ¯</h2>
        <button class="test-button" onclick="showDebugInfo()">æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</button>
        <div id="debug-info"></div>
    </div>

    <!-- åŠ è½½å¿…è¦çš„è„šæœ¬ -->
    <script src="javascripts/auth-config.js"></script>
    <script src="javascripts/config-sync.js"></script>

    <script>
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function checkBasicSetup() {
            let status = 'åŸºç¡€æ£€æŸ¥ç»“æœï¼š<br>';
            
            // æ£€æŸ¥å¿…è¦çš„å…¨å±€å¯¹è±¡
            status += `window.AUTH_CONFIG: ${!!window.AUTH_CONFIG}<br>`;
            status += `window.configSync: ${!!window.configSync}<br>`;
            status += `initializeConfigSyncå‡½æ•°: ${typeof window.initializeConfigSync}<br>`;
            
            // æ£€æŸ¥localStorage
            const hasLocalConfig = !!localStorage.getItem('fl510_docs_config');
            status += `æœ¬åœ°é…ç½®: ${hasLocalConfig}<br>`;
            
            // æ£€æŸ¥GitHub token
            const hasGitHubToken = !!localStorage.getItem('github_sync_token');
            status += `GitHub Token: ${hasGitHubToken}<br>`;
            
            showStatus('basic-status', status, hasLocalConfig || hasGitHubToken ? 'success' : 'info');
        }

        function checkConfigSync() {
            let status = 'ConfigSyncå¯¹è±¡æ£€æŸ¥ï¼š<br>';
            
            if (!window.configSync) {
                showStatus('configsync-status', 'âŒ window.configSync ä¸å­˜åœ¨', 'error');
                return;
            }
            
            status += `å¯¹è±¡å­˜åœ¨: âœ…<br>`;
            status += `å·²åˆå§‹åŒ–: ${window.configSync.initialized ? 'âœ…' : 'âŒ'}<br>`;
            status += `setupSyncæ–¹æ³•: ${typeof window.configSync.setupSync}<br>`;
            status += `syncConfigæ–¹æ³•: ${typeof window.configSync.syncConfig}<br>`;
            status += `loadConfigæ–¹æ³•: ${typeof window.configSync.loadConfig}<br>`;
            status += `disableSyncæ–¹æ³•: ${typeof window.configSync.disableSync}<br>`;
            
            const allMethodsExist = typeof window.configSync.setupSync === 'function' &&
                                  typeof window.configSync.syncConfig === 'function' &&
                                  typeof window.configSync.loadConfig === 'function' &&
                                  typeof window.configSync.disableSync === 'function';
            
            showStatus('configsync-status', status, allMethodsExist ? 'success' : 'error');
        }

        function testInitialization() {
            let status = 'åˆå§‹åŒ–æµ‹è¯•ï¼š<br>';
            
            try {
                if (typeof window.initializeConfigSync === 'function') {
                    window.initializeConfigSync();
                    status += 'âœ… åˆå§‹åŒ–å‡½æ•°è°ƒç”¨æˆåŠŸ<br>';
                    status += `åˆå§‹åŒ–çŠ¶æ€: ${window.configSync.initialized ? 'âœ…' : 'âŒ'}<br>`;
                } else {
                    status += 'âŒ åˆå§‹åŒ–å‡½æ•°ä¸å­˜åœ¨<br>';
                }
            } catch (error) {
                status += `âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}<br>`;
            }
            
            showStatus('init-status', status, window.configSync.initialized ? 'success' : 'error');
        }

        function testMethods() {
            let status = 'æ–¹æ³•è°ƒç”¨æµ‹è¯•ï¼š<br>';
            
            try {
                // æµ‹è¯•setupSync
                if (typeof window.configSync.setupSync === 'function') {
                    status += 'âœ… setupSyncæ–¹æ³•å¯è°ƒç”¨<br>';
                } else {
                    status += 'âŒ setupSyncæ–¹æ³•ä¸å¯ç”¨<br>';
                }
                
                // æµ‹è¯•loadConfig
                if (typeof window.configSync.loadConfig === 'function') {
                    status += 'âœ… loadConfigæ–¹æ³•å¯è°ƒç”¨<br>';
                } else {
                    status += 'âŒ loadConfigæ–¹æ³•ä¸å¯ç”¨<br>';
                }
                
            } catch (error) {
                status += `âŒ æ–¹æ³•æµ‹è¯•å¤±è´¥: ${error.message}<br>`;
            }
            
            showStatus('methods-status', status, 'info');
        }

        function manualInit() {
            let status = 'æ‰‹åŠ¨åˆå§‹åŒ–ï¼š<br>';
            
            try {
                // å¼ºåˆ¶é‡æ–°åˆå§‹åŒ–
                if (window.configSync) {
                    window.configSync.initialized = false;
                }
                
                if (typeof window.initializeConfigSync === 'function') {
                    window.initializeConfigSync();
                    status += 'âœ… æ‰‹åŠ¨åˆå§‹åŒ–å®Œæˆ<br>';
                    status += `å½“å‰çŠ¶æ€: ${window.configSync.initialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}<br>`;
                } else {
                    status += 'âŒ åˆå§‹åŒ–å‡½æ•°ä¸å¯ç”¨<br>';
                }
            } catch (error) {
                status += `âŒ æ‰‹åŠ¨åˆå§‹åŒ–å¤±è´¥: ${error.message}<br>`;
            }
            
            showStatus('manual-status', status, window.configSync.initialized ? 'success' : 'error');
        }

        function showDebugInfo() {
            let debugInfo = 'è°ƒè¯•ä¿¡æ¯ï¼š<br><pre>';
            
            debugInfo += `window.configSync: ${JSON.stringify(window.configSync, null, 2)}\n\n`;
            debugInfo += `window.AUTH_CONFIG: ${JSON.stringify(window.AUTH_CONFIG, null, 2)}\n\n`;
            debugInfo += `localStorage keys: ${Object.keys(localStorage).join(', ')}\n\n`;
            debugInfo += `document.readyState: ${document.readyState}\n\n`;
            debugInfo += `navigator.userAgent: ${navigator.userAgent}\n`;
            
            debugInfo += '</pre>';
            
            showStatus('debug-info', debugInfo, 'info');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', function() {
            setTimeout(() => {
                checkBasicSetup();
                checkConfigSync();
            }, 1000);
        });
    </script>
</body>
</html>
